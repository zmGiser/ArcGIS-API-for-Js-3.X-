// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/htmlToSvg/supportClasses/imageUtils/ImageReplacer","dojo/Deferred dojo/when dojo/promise/all dojo/query dojo/dom-style ../VisibilityChecker ../../../ImageInfoUtil".split(" "),function(h,k,e,g,l,m,n){g={};var q=/^data:/i,r=/^url\s*\(/i,t=/url\("data:|url\(data:/i,p={getImages:function(a){a=a.getElementsByTagName("img");for(var d=[],c=0;c<a.length;c++){var b=a[c];!q.test(b.src)&&m.checkNode(b)&&d.push(a[c])}return d},getBackgroundImageNodes:function(a){function d(a){if(a&&
a.children)for(var b=0;b<a.children.length;b++){var f=a.children[b];if("IMG"!==f.nodeName&&m.checkNode(f)){var e=l.get(f,"backgroundImage");e&&r.test(e)&&!t.test(e)&&c.push(f);d(f)}}}var c=[];d(a);return c}},u={replaceImages:function(a){return e(a.map(function(a){return k(n.getRemoteImageDataUrl(a.src),function(c){if(c!==a.src){var b=a.src,d=new h;a.onload=d.resolve;a.onerror=function(){a.src=b};a.src=c;return d.promise}})}))}},v={replaceBackgroundNodes:function(a){return e(a.map(function(a){var c=
l.get(a,"backgroundImage").replace(/^url\s*\(/i,"").replace(")","").replace(/"/g,"").trim();return k(n.getRemoteImageDataUrl(c),function(b){if(b!==c)return a.style.backgroundImage="url("+b+")",b=new h,setTimeout(b.resolve),b.promise})}))}};g.replaceImagesWithDataURL=function(a){var d=p.getImages(a);a=p.getBackgroundImageNodes(a);return e([u.replaceImages(d),v.replaceBackgroundNodes(a)])};return g});