// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProviders/supportClasses/tasks/EnrichAreasTask","dojo/_base/declare dojo/_base/lang esri/kernel esri/SpatialReference esri/graphic ../GEUtil esri/dijit/geoenrichment/utils/GeometryUtil".split(" "),function(k,f,l,m,n,p,g){function h(){var a=l.id.credentials[0];return a&&a.token}return k(null,{enrichAreas:function(a){var b={};b.studyAreas=this._analysisAreasToStudyAreas(a.analysisAreas,a.countryID);a.report?b.analysisVariables=[{itemid:a.report.reportID,
url:a.report.portalUrl,token:h(),outFields:["*"]}]:a.fields&&(b.analysisVariables=a.fields);return this._doRunTask(b,a,"enrich")},createReport:function(a){var b={f:"bin",format:"xml",reportfields:{}};b.report={itemid:a.report.reportID,url:a.report.portalUrl,token:h()};b.studyAreas=this._analysisAreasToStudyAreas(a.analysisAreas,a.countryID);return this._doRunTask(b,a,"createReport")},_analysisAreasToStudyAreas:function(a,b){var d=this,c=[],e=a.map(function(a){if(a.geographies&&a.geographies.length)return d._studyAreaFromGeographies(a.geographies,
b,!0);c.push(a.feature);return"feature"}),c=this._generalizeFeatures(c);return e=e.map(function(a){return"feature"===a?(a=c.shift(),{attributes:f.mixin({},a.attributes),geometry:a.geometry.toJson()}):a})},_generalizeFeatures:function(a,b){b=void 0!==b?b:0;var d=g.needGeneralizeGeometry(a,0<b?3*b:-3,0);d&&(a=a.map(function(a){return new n(a.geometry,a.symbol,a.attributes)}),g.generalizeGeometry(a,d,0));return a},createFeatureForGeographies:function(a,b){var d={returnGeometry:!0,outSR:new m(102100),
studyAreas:[this._studyAreaFromGeographies(a,b.countryID,!0)],dataCollections:["GlobalIntersect"]};return this._doRunTask(d,b,"enrich")},_studyAreaFromGeographies:function(a,b,d){b={sourceCountry:b,layer:null,ids:null};var c=null,e=[];a.forEach(function(a){if(!a||!a.id)throw Error("Wrong geography.");var b=a.levelId;if(b)if(!c)c=b;else if(c!==b)throw Error("Geographies have different level IDs.");e.push(a.id)});b.layer=c;b.ids=d?[e.join(",")]:e;return b},_doRunTask:function(a,b,d){a=f.mixin({f:"json",
useData:{sourceCountry:b.countryID,hierarchy:b.hierarchy||"census"},forStorage:!1},a);for(var c in a){var e=a[c];"object"==typeof e&&(a[c]=JSON.stringify(e))}return p[d](b.geoenrichmentUrl,a)}})});