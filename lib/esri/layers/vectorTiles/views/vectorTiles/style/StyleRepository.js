// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/vectorTiles/style/StyleRepository",["require","exports","./StyleLayer","dojo/has"],function(l,m,g,k){return function(){function f(a,d){this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=d?d.spriteUrl:a.sprite;this.glyphs=d?d.glyphsUrl:a.glyphs;if(k("stable-symbol-rendering")){var e=(a.layers||[]).filter(function(a){return a.layout&&a.layout["text-font"]})[0];e&&(a.layers||[]).forEach(function(a){a.layout&&a.layout["text-font"]&&(a.layout["text-font"]=
e.layout["text-font"])})}this.layers=(a.layers||[]).map(f._create);this._identifyRefLayers()}f.prototype._identifyRefLayers=function(){for(var a=[],d=[],e=0,f=this.layers;e<f.length;e++){var b=f[e];if(1===b.type){var c=b.sourceLayer,c=c+("|"+JSON.stringify(b.minzoom)),c=c+("|"+JSON.stringify(b.maxzoom)),c=c+("|"+JSON.stringify(b.filter));a.push({key:c,layer:b})}2===b.type&&(c=b.sourceLayer,c+="|"+JSON.stringify(b.minzoom),c+="|"+JSON.stringify(b.maxzoom),c+="|"+JSON.stringify(b.filter),c+="|"+JSON.stringify(b.layout&&
b.layout["line-cap"]),c+="|"+JSON.stringify(b.layout&&b.layout["line-join"]),d.push({key:c,layer:b}))}this._assignRefLayers(a);this._assignRefLayers(d)};f.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var d,e,f=a.length,b=0;b<f;b++){var c=a[b];if(c.key===d)c.layer.refLayerId=e;else if(d=c.key,e=c.layer.id,1===c.layer.type&&!c.layer.hasPaintProperty("fill-outline-color"))for(var g=b+1;g<f;g++){var h=a[g];if(h.key===d){if(h.layer.hasPaintProperty("fill-outline-color")){a[b]=
h;a[g]=c;e=h.layer.id;break}}else break}}};f._create=function(a,d,e){d=1-1/(e.length+1)*(1+d);switch(a.type){case "background":return new g.StyleLayer(0,a,d);case "fill":return new g.StyleLayer(1,a,d);case "line":return new g.StyleLayer(2,a,d);case "symbol":return new g.StyleLayer(3,a,d);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":throw Error("Unsupported vector tile circle layer");}throw Error("Unknown vector tile layer");};return f}()});