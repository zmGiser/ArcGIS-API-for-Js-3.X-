// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/templateJsonUtils/RichTextJsonUtil",["./utils","./countryConfig"],function(k,m){var e={},n={_reCache:{},getRegExp:function(){var a=m.getCurrencySymbol();this._reCache[a]||(this._reCache[a]=new RegExp("[\\"+a+"%]*\\[[^\\[]*\\]%*","g"));return this._reCache[a]}};e.collectFieldInfosFromRenderedXMLString=function(a,b){var c={},d={};b&&b.fieldInfos.forEach(function(a){c[k.renderer.renderFieldInfoInTableCell(a)]=a});b&&b.specialFieldInfos.forEach(function(a){d[k.renderer.renderFieldInfoInTableCell(a)]=
a});var e=[],g=[],h=a.match(n.getRegExp());h&&h.forEach(function(b){var f=c[b]||d[b]||k.builder.createFieldInfoFromSpecialFieldName(b.replace(/\[|\]/g,""))||k.builder.getFieldInfoFromLabel(b);f&&(f.hasVariable||f.script?(e.push(f),a=a.replace(b,"\x3cd/\x3e")):(g.push(f),a=a.replace(b,"\x3ctext/\x3e")))});return{xmlString:a,fieldInfos:e,specialFieldInfos:g}};var p=/<d[^\/]*\/>/,q=/<text[^\/]*\/>/,h=/<reportname\s*\/\>/i,l=/<reporttitle2\s*\/\>/i;e.createFieldInfoFromRichText=function(a,b,c){a=a||"";
b=b||[];c=c||[];for(var d=0;d<b.length;d++)a=a.replace(p,e._wrapFieldInfoInRichText(b[d]));for(d=0;d<c.length;d++){var f=c[d],g;g="Title"==f.name&&h.test(a)?h:"Subtitle"==f.name&&l.test(a)?l:q;a=a.replace(g,e._wrapFieldInfoInRichText(f))}return{isRichText:!0,richTextJson:{fieldInfos:b,specialFieldInfos:c,xmlString:a}}};e.createRichTextFromFieldInfo=function(a,b,c){a=a.richTextJson;var d=a.xmlString;a.fieldInfos.forEach(function(a){var c=b(a);d=d.replace(e._wrapFieldInfoInRichText(a),c||"")});a.specialFieldInfos.forEach(function(a){var b=
c(a);d=d.replace(e._wrapFieldInfoInRichText(a),b||"")});return d};e.addFieldInfosToRichTextFieldInfo=function(a,b){var c=a.richTextJson;c.xmlString+=b.map(function(a){a.hasVariable?c.fieldInfos.push(a):c.specialFieldInfos.push(a);return e._wrapFieldInfoInRichText(a)}).join(", ")};e._wrapFieldInfoInRichText=function(a){return"["+a.name+"]"};e.updateXMLString=function(a,b){b.forEach(function(b){a=a.replace(new RegExp("\\["+b.nameBefore+"\\]","g"),"["+b.name+"]")});return a};return e});