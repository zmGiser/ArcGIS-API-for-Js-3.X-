// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProviders/commands/CreatePDFCommand","dojo/_base/declare dojo/_base/lang dojo/when esri/dijit/geoenrichment/utils/FileUtil esri/dijit/geoenrichment/utils/JsonXmlConverter esri/dijit/geoenrichment/utils/requests/FileContent ./CreateHTMLCommand ./supportClasses/PlayerCommands ../supportClasses/GEUtil esri/dijit/geoenrichment/ReportPlayer/core/conversion/reportingEngine/converters/DocumentConverter esri/dijit/geoenrichment/ReportPlayer/core/conversion/ConversionUtil esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/DocumentOptions esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes".split(" "),
function(h,k,l,m,n,p,q,r,f,t,g,u,v){var x={buildLayoutXML:function(b){var d=t.buildDocumentTag({report:{templateJson:{documentOptions:k.mixin({},b.documentOptions,{left:0,right:0,top:0,bottom:0})}}}),a=u.getPageBox(b.documentOptions),e=g.pxToPt(a.w),w=g.pxToPt(a.h);b.svgStrings.forEach(function(c,a){d.tags.push({name:"section",attributes:{type:v.DETAILS},tags:[{name:"img",attributes:{left:0,top:0,width:e,height:w},tags:[{text:"__svgString__"+a+"__svgString__"}]}]});a<b.svgStrings.length-1&&d.tags.push({name:"pageBreak"})});
var c=n.parseJson(d);b.svgStrings.forEach(function(b,a){c=c.replace("__svgString__"+a+"__svgString__",b)});return c}};return h(q,{id:r.PDF,_saveFiles:!1,_stopPrintableContainer:!1,_mode:"svg",_requestSizeLimit:9E6,execute:function(b,d){var a=this,e=function(b){return a._handleError(b)};return l(this.inherited(arguments),function(a){if(a.svgStrings){var c=x.buildLayoutXML(a);if(d.returnLayoutXMLOnly)return c;a={report:b.getReportTitle(),format:"pdf",f:"bin"};c=p.fromFileData("report.xml",c);delete c.filename;
a["report.xml"]=c;return f.formatReport(b.getReportData().config.geoenrichmentUrl,a).then(function(a){a&&a.data?(d.creditsTaskID&&f.consumeCredits(b.getReportData().config.geoenrichmentUrl,d.creditsTaskID),m.saveAs(a.data,b.getReportTitle()+".pdf")):e()})}},e).always(function(){return a._printableContainer&&a._printableContainer.stop()})},_handleError:function(b){console.log(b);alert("Can't generate an PDF. Please try again later.")}})});