// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProviders/commands/CreateHTMLCommand","dojo/_base/declare dojo/_base/lang dojo/promise/all dojo/when dijit/Dialog ./createHTML/HTMLToSVGBuilder ./createHTML/HTMLStringBuilder ./createHTML/CommandMode esri/dijit/geoenrichment/utils/FileUtil ./supportClasses/MapToImageUtil ./supportClasses/PlayerCommands dojo/i18n!../../../../../nls/jsapi".split(" "),function(r,y,t,g,h,p,u,l,v,w,x,d){d=d.geoenrichment.dijit.ReportPlayer.ReportPlayer;return r(null,{id:x.HTML,
errorMessage:d.createHTMLError,exportMapErrorMessage:d.exportMapError,_saveFiles:!0,_stopPrintableContainer:!0,_printableContainer:null,_mode:l.SVG_IN_HTML,_requestSizeLimit:0,execute:function(q,b){function d(){return g(f&&f.undo(),function(){return e._stopPrintableContainer&&c&&c.stop()})}function h(a){e._handleError(a)}var e=this,c,f,k={svgInHtmlString:null,svgStrings:null,documentOptions:null};return g(function(){function a(){return t([c.getFitParams(),c.getHeaderFooterParams(),c.getDocumentOptions()]).then(function(a){return{fitParams:a[0],
headerFooterParams:a[1],documentOptions:a[2]}})}c=b.printableContainer;e._printableContainer=c;return g(w.replaceMapWithImage(q,{saveImagesAsBase64:!0,printMapTaskUrl:b.printMapTaskUrl}),function(b){f=b;return a()})}(),function(a){if(c)return g(u.buildHtmlStringForPlayer(c,a.headerFooterParams,a.documentOptions),function(c){function d(a,c){if(!b.returnAsHtmlText&&!b.returnAsSvgText&&e._saveFiles&&a)return e._confirmSaveFile(c,function(){v.saveTextFile(a,c)})}function f(){var b=m+".svg";return g(p.htmlToSvg(c.domString,
a.fitParams,e._requestSizeLimit),function(a){k.svgStrings=a;return d(a[0],b)})}function h(){var b=m+".html";return g(p.htmlToSvgInHtml(c.domString,m,a.fitParams,e._requestSizeLimit),function(a){k.svgInHtmlString=a;return d(a,b)})}if(c.domString){var m=q.getReportTitle();k.documentOptions=a.documentOptions;var n=e._mode;b.returnAsHtmlText&&(n=l.SVG_IN_HTML);b.returnAsSvgText&&(n=l.SVG);switch(n){case l.SVG:return f(a);case l.SVG_IN_HTML:return h(a)}}},h)},h).always(function(){return g(d(),function(){f&&
f.errors.length&&e._handleExportMapError(f.errors[0]);return b.returnAsHtmlText?k.svgInHtmlString:b.returnAsSvgText?k.svgStrings:k})})},_handleError:function(d){console.log(d);(new h({title:"Error",content:this.errorMessage})).show()},_handleExportMapError:function(d){console.log(d);(new h({title:"Error",content:this.exportMapErrorMessage})).show()},_confirmSaveFile:function(d,b){return b()}})});