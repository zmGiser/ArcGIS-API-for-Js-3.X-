// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProviders/supportClasses/tasks/RunReportTask","dojo/_base/declare dojo/Deferred esri/graphic esri/tasks/FeatureSet ./EnrichAreasTask esri/dijit/geoenrichment/utils/JsonXmlConverter".split(" "),function(k,g,l,m,n,p){var q={execute:function(b){var h=this;return(new n).createReport(b).then(function(a){var b=a&&a.taskID;a=a&&a.result;var f;try{var c;a&&"object"==typeof a&&(c=a.error);if(!c&&"string"==typeof a&&-1!=a.indexOf("{"))try{var d=JSON.parse(a);
c=d&&d.error}catch(e){}if(c)return(new g).reject(c);f=p.parseXml(a);return{taskID:b,featureSets:h._parseDataXmlJson(f)}}catch(e){return(new g).reject(e)}})},_parseDataXmlJson:function(b){function h(b){function c(b,c){var d,e={};b.tags.forEach(function(a){var b;b=a.innerHTML?a.innerHTML:a.tags&&a.tags.length&&a.tags[0].text||"";if(!e[a.name]){var c=Number(b);e[a.name]=b.length&&!isNaN(c)?c:b}"AREA_ID"==a.name&&(d=b)});void 0!==d&&((a[c]=a[c]||{})[d]=e,void 0===f[d]&&(f[d]=g++))}b.tags[0].tags.forEach(function(a){"xs:schema"!=
a.name&&"headers"!=a.name&&c(a,a.name)})}if(!b||!b.tags||2>b.tags.length)return null;var a={},g=0,f={};b.tags.forEach(function(a){"ReportData"==a.name&&h(a)});b=[];for(var c in a){var d=new m;d.calculatorName=c;for(var e in a[c])d.features[f[e]]=new l(null,null,a[c][e]);b.push(d)}return b}};return k(null,{execute:function(b){return q.execute(b)}})});